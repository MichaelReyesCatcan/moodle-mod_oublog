define("mod_oublog/accordion",["exports","core/config"],(function(_exports,_config){var obj;
/*
   * Handle expand/collapse of areas within the blog usage block.
   *
   * @package mod_oublog/accordion
   * @copyright 2024 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setUserPreference=_exports.init=void 0,_config=(obj=_config)&&obj.__esModule?obj:{default:obj};let id=0;_exports.init=(containerClass,defaultOpen)=>{const container=document.querySelector("ul.oublog-accordion-"+containerClass);if(!container)return;container.setAttribute("tabindex",0);let counter=1;const tabs=container.querySelectorAll("li");(!defaultOpen||tabs.length<defaultOpen)&&(defaultOpen=1),tabs.forEach((tab=>{const generateID=getNextId();tab.dataset.containerClass=containerClass,tab.dataset.number=counter,tab.dataset.state=1;const title=tab.querySelector(".oublog_statsview_title h2");title.style.userSelect="none",title.setAttribute("aria-controls",generateID),title.setAttribute("role","tab"),title.setAttribute("tabindex",0);const content=tab.querySelector(".oublog_statsview_content");content.setAttribute("aria-labeledby",generateID),content.setAttribute("role","tabpanel"),parseInt(defaultOpen)!==counter?closeTab(tab,content):(content.classList.add("oublog-accordion-open"),tab.classList.add("oublog-accordion-open")),title.addEventListener("click",(e=>{e.preventDefault(),toggleAccordion(tab,content)})),title.addEventListener("keydown",(e=>{13===e.keyCode&&(e.preventDefault(),toggleAccordion(tab,content))})),counter++}));const headings=container.querySelectorAll(".oublog_statsview_title h2");headings.forEach((heading=>{heading.addEventListener("focus",(e=>{e.target.parentNode.classList.add("focus")}))})),container.addEventListener("keydown",(e=>{const focusedElement=document.activeElement,index=[...headings].indexOf(focusedElement);38===e.keyCode&&"H2"===focusedElement.nodeName&&(e.preventDefault(),index>0?headings[index-1].focus():headings[headings.length-1].focus()),40===e.keyCode&&"H2"===focusedElement.nodeName&&(e.preventDefault(),index===headings.length-1?headings[0].focus():headings[index+1].focus())}))};const toggleAccordion=(tab,content)=>1===parseInt(tab.dataset.state)?closeTab(tab,content):openTab(tab,content),getNextId=()=>"oublog_accordion_"+id++,closeTab=(tab,content)=>{tab.classList.remove("oublog-accordion-open"),tab.classList.add("oublog-accordion-closed"),content.classList.remove("oublog-accordion-open"),content.classList.add("oublog-accordion-closed"),tab.dataset.state=0},openTab=(tab,content)=>{tab.parentNode.querySelectorAll("li.oublog-accordion-open").forEach((tabRef=>{const content=tabRef.querySelector(".oublog_statsview_content");closeTab(tabRef,content)})),tab.classList.remove("oublog-accordion-closed"),tab.classList.add("oublog-accordion-open"),content.classList.remove("oublog-accordion-closed"),content.classList.add("oublog-accordion-open"),tab.dataset.state=1,document.body.classList.contains("notloggedin")||setUserPreference("oublog_accordion_"+tab.dataset.containerClass+"_open",tab.dataset.number)},setUserPreference=(name,value)=>{const url=new URL(_config.default.wwwroot+"/lib/ajax/setuserpref.php");url.searchParams.set("sesskey",_config.default.sesskey),url.searchParams.set("pref",encodeURI(name)),url.searchParams.set("value",encodeURI(value)),fetch(url).then((res=>{_config.default.developerdebug&&!res.ok&&window.console.error(res)})).catch((error=>{_config.default.developerdebug&&(window.console.error(error),alert("Error updating user preference '"+name+"' using ajax. Clicking this link will repeat the Ajax call that failed so you can see the error: "))}))};_exports.setUserPreference=setUserPreference}));

//# sourceMappingURL=accordion.min.js.map