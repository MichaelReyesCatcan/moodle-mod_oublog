{"version":3,"file":"accordion.min.js","sources":["../src/accordion.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {setUserPreference} from 'core_user/repository';\n\n/*\n * Handle expand/collapse of areas within the blog usage block.\n *\n * @package mod_oublog/accordion\n * @copyright 2024 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// Unique id for each accordion.\nlet id = 0;\n\n/**\n * Initialize the accordion.\n *\n * @param {string} containerClass The class of the container to apply the accordion to.\n * @param {number} defaultOpen The default tab to open.\n * @return void\n */\nexport const init = (containerClass, defaultOpen) => {\n    const container = document.querySelector('ul.oublog-accordion-' + containerClass);\n    if (!container) {\n        return;\n    }\n    container.setAttribute('tabindex', 0);\n    let counter = 1;\n    // Setup UI.\n    const tabs = container.querySelectorAll('li');\n    if (!defaultOpen || tabs.length < defaultOpen) {\n        defaultOpen = 1;\n    }\n\n    // Initialize event for each tab.\n    tabs.forEach((tab) => {\n        const generateID = getNextId();\n        // Set data set for each tab element.\n        tab.dataset.containerClass = containerClass;\n        tab.dataset.number = counter;\n        // Set the state of the tab.\n        // State 1 = open, 0 = closed.\n        tab.dataset.state = 1;\n\n        // Set the title and content of the tab.\n        const title = tab.querySelector('.oublog_statsview_title h2');\n        title.style.userSelect = 'none';\n        title.setAttribute('aria-controls', generateID);\n        title.setAttribute('role', 'tab');\n        title.setAttribute('tabindex', 0);\n        const content = tab.querySelector('.oublog_statsview_content');\n        content.setAttribute('aria-labeledby', generateID);\n        content.setAttribute('role', 'tabpanel');\n\n        // Set the default open tab.\n        if (parseInt(defaultOpen) !== counter) {\n            closeTab(tab, content);\n        } else {\n            // Manual open to stop others being closed.\n            content.classList.add('oublog-accordion-open');\n            tab.classList.add('oublog-accordion-open');\n        }\n\n        // Add event listener for the click event.\n        title.addEventListener('click', (e) => {\n            e.preventDefault();\n            toggleAccordion(tab, content);\n        });\n\n        // Add event listener for the enter key.\n        title.addEventListener('keydown', (e) => {\n            if (e.keyCode === 13) {\n                e.preventDefault();\n                toggleAccordion(tab, content);\n            }\n        });\n        counter++;\n    });\n\n    // Keep track of the open tab for current user by focusing on the tab.\n    const headings = container.querySelectorAll('.oublog_statsview_title h2');\n    headings.forEach((heading) => {\n        heading.addEventListener('focus', (e) => {\n            e.target.parentNode.classList.add('focus');\n        });\n    });\n\n    // Navigate through the tabs using the up and down arrow keys.\n    container.addEventListener('keydown', (e) => {\n        const focusedElement = document.activeElement;\n        const index = [...headings].indexOf(focusedElement);\n\n        // Handle 'up' key (keyCode 38).\n        if (e.keyCode === 38 && focusedElement.nodeName === 'H2') {\n            e.preventDefault();\n            if (index > 0) {\n                headings[index - 1].focus();\n            } else {\n                headings[headings.length - 1].focus();\n            }\n        }\n\n        // Handle 'down' key (keyCode 40).\n        if (e.keyCode === 40 && focusedElement.nodeName === 'H2') {\n            e.preventDefault();\n            if (index === headings.length - 1) {\n                headings[0].focus();\n            } else {\n                headings[index + 1].focus();\n            }\n        }\n    });\n};\n\n/**\n * Toggle the accordion.\n *\n * @param {HTMLDivElement} tab The tab to close.\n * @param {HTMLDivElement} content The content of the tab.\n * @return void\n */\nconst toggleAccordion = (tab, content) => {\n    return parseInt(tab.dataset.state) === 1 ?\n        closeTab(tab, content) :\n        openTab(tab, content);\n};\n\n/**\n * Returns the unique id.\n *\n * @return {string} New unique id\n */\nconst getNextId = () => {\n    return 'oublog_accordion_' + id++;\n};\n\n/**\n * Close a tab.\n *\n * @param {HTMLDivElement} tab The tab to close.\n * @param {HTMLDivElement} content The content of the tab.\n * @return void\n */\nconst closeTab = (tab, content) => {\n    tab.classList.remove('oublog-accordion-open');\n    tab.classList.add('oublog-accordion-closed');\n    content.classList.remove('oublog-accordion-open');\n    content.classList.add('oublog-accordion-closed');\n    tab.dataset.state = 0;\n};\n\n/**\n * Open a tab.\n *\n * @param {HTMLDivElement} tab The tab to open.\n * @param {HTMLDivElement} content The content of the tab.\n * @return void\n */\nconst openTab = (tab, content) => {\n    // Shut all other tabs.\n    const tabs = tab.parentNode.querySelectorAll('li.oublog-accordion-open');\n    tabs.forEach((tabRef) => {\n        const content = tabRef.querySelector('.oublog_statsview_content');\n        closeTab(tabRef, content);\n    });\n\n    tab.classList.remove('oublog-accordion-closed');\n    tab.classList.add('oublog-accordion-open');\n    content.classList.remove('oublog-accordion-closed');\n    content.classList.add('oublog-accordion-open');\n    tab.dataset.state = 1;\n\n    // Keep track of the open tab for current user.\n    if (!document.body.classList.contains('notloggedin')) {\n        setUserPreference('oublog_accordion_' + tab.dataset.containerClass + '_open', tab.dataset.number);\n    }\n};\n"],"names":["id","containerClass","defaultOpen","container","document","querySelector","setAttribute","counter","tabs","querySelectorAll","length","forEach","tab","generateID","getNextId","dataset","number","state","title","style","userSelect","content","parseInt","closeTab","classList","add","addEventListener","e","preventDefault","toggleAccordion","keyCode","headings","heading","target","parentNode","focusedElement","activeElement","index","indexOf","nodeName","focus","openTab","remove","tabRef","body","contains"],"mappings":";;;;;;;;IA0BIA,GAAK,gBASW,CAACC,eAAgBC,qBAC3BC,UAAYC,SAASC,cAAc,uBAAyBJ,oBAC7DE,iBAGLA,UAAUG,aAAa,WAAY,OAC/BC,QAAU,QAERC,KAAOL,UAAUM,iBAAiB,QACnCP,aAAeM,KAAKE,OAASR,eAC9BA,YAAc,GAIlBM,KAAKG,SAASC,YACJC,WAAaC,YAEnBF,IAAIG,QAAQd,eAAiBA,eAC7BW,IAAIG,QAAQC,OAAST,QAGrBK,IAAIG,QAAQE,MAAQ,QAGdC,MAAQN,IAAIP,cAAc,8BAChCa,MAAMC,MAAMC,WAAa,OACzBF,MAAMZ,aAAa,gBAAiBO,YACpCK,MAAMZ,aAAa,OAAQ,OAC3BY,MAAMZ,aAAa,WAAY,SACzBe,QAAUT,IAAIP,cAAc,6BAClCgB,QAAQf,aAAa,iBAAkBO,YACvCQ,QAAQf,aAAa,OAAQ,YAGzBgB,SAASpB,eAAiBK,QAC1BgB,SAASX,IAAKS,UAGdA,QAAQG,UAAUC,IAAI,yBACtBb,IAAIY,UAAUC,IAAI,0BAItBP,MAAMQ,iBAAiB,SAAUC,IAC7BA,EAAEC,iBACFC,gBAAgBjB,IAAKS,YAIzBH,MAAMQ,iBAAiB,WAAYC,IACb,KAAdA,EAAEG,UACFH,EAAEC,iBACFC,gBAAgBjB,IAAKS,aAG7Bd,mBAIEwB,SAAW5B,UAAUM,iBAAiB,8BAC5CsB,SAASpB,SAASqB,UACdA,QAAQN,iBAAiB,SAAUC,IAC/BA,EAAEM,OAAOC,WAAWV,UAAUC,IAAI,eAK1CtB,UAAUuB,iBAAiB,WAAYC,UAC7BQ,eAAiB/B,SAASgC,cAC1BC,MAAQ,IAAIN,UAAUO,QAAQH,gBAGlB,KAAdR,EAAEG,SAA8C,OAA5BK,eAAeI,WACnCZ,EAAEC,iBACES,MAAQ,EACRN,SAASM,MAAQ,GAAGG,QAEpBT,SAASA,SAASrB,OAAS,GAAG8B,SAKpB,KAAdb,EAAEG,SAA8C,OAA5BK,eAAeI,WACnCZ,EAAEC,iBACES,QAAUN,SAASrB,OAAS,EAC5BqB,SAAS,GAAGS,QAEZT,SAASM,MAAQ,GAAGG,mBAa9BX,gBAAkB,CAACjB,IAAKS,UACa,IAAhCC,SAASV,IAAIG,QAAQE,OACxBM,SAASX,IAAKS,SACdoB,QAAQ7B,IAAKS,SAQfP,UAAY,IACP,oBAAsBd,KAU3BuB,SAAW,CAACX,IAAKS,WACnBT,IAAIY,UAAUkB,OAAO,yBACrB9B,IAAIY,UAAUC,IAAI,2BAClBJ,QAAQG,UAAUkB,OAAO,yBACzBrB,QAAQG,UAAUC,IAAI,2BACtBb,IAAIG,QAAQE,MAAQ,GAUlBwB,QAAU,CAAC7B,IAAKS,WAELT,IAAIsB,WAAWzB,iBAAiB,4BACxCE,SAASgC,eACJtB,QAAUsB,OAAOtC,cAAc,6BACrCkB,SAASoB,OAAQtB,YAGrBT,IAAIY,UAAUkB,OAAO,2BACrB9B,IAAIY,UAAUC,IAAI,yBAClBJ,QAAQG,UAAUkB,OAAO,2BACzBrB,QAAQG,UAAUC,IAAI,yBACtBb,IAAIG,QAAQE,MAAQ,EAGfb,SAASwC,KAAKpB,UAAUqB,SAAS,kDAChB,oBAAsBjC,IAAIG,QAAQd,eAAiB,QAASW,IAAIG,QAAQC"}